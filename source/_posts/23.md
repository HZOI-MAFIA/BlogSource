---
title: "[Jxoi2012] 奇怪的道路"
date: 2017-7-28 19:45:55
categories: 
	题解
tags:
	DP
toc: true
---
# 题目
[传送门](http://www.lydsy.com/JudgeOnline/problem.php?id=3195)  
小宇从历史书上了解到一个古老的文明。这个文明在各个方面高度发达，交通方面也不例外。考古学家已经知道，这个文明在全盛时期有n座城市，编号为1..n。m条道路连接在这些城市之间，每条道路将两个城市连接起来，使得两地的居民可以方便地来往。一对城市之间可能存在多条道路。  
<!--more-->
据史料记载，这个文明的交通网络满足两个奇怪的特征。首先，这个文明崇拜数字K，所以对于任何一条道路，设它连接的两个城市分别为u和v，则必定满足1 <=|u - v| <= K。此外，任何一个城市都与恰好偶数条道路相连（0也被认为是偶数）。不过，由于时间过于久远，具体的交通网络我们已经无法得知了。小宇很好奇这n个城市之间究竟有多少种可能的连接方法，于是她向你求助。  
方法数可能很大，你只需要输出方法数模1000000007后的结果。
# INPUT
输入共一行，为3个整数n，m，K。
# OUTPUT
输出1个整数，表示方案数模1000000007后的结果。
# SAMPLE
## INPUT1
3 4 1
## OUTPUT1
3
## INPUT2
4 3 3
## OUTPUT2
4
# 解题报告
考试时候想到了DP，一看数据范围也想到了状压，然而就是不会打，果然我DP就是弱啊- -  
正解：  
仍然考虑状压，将i-K到i的度的奇偶性压成一维，设f[i][j][k][l]表示到点i，用了j条边，i-K的奇偶性状态为k，当前处理i-K+l和i之间的连边。  
如果这条边不连,可以转移到f[i][j][k][l+1].  
如果这条边连,可以转移到f[i][j][k^(1<<K)^(1<<l)][l].  
如果l=K并且i-K的度为偶数,可以转移到f[i+1][j][k>>1][0];  
最后答案就是f[n+1][m][0][0];
需要注意的是特判，当你决定这条边需要连的时候，你需要判断这条边是否合法，因为我们是确定i，然后从i前面的点转移过来的，所以很有可能出现不合法的边，比如你当前的i为4，而你的K为8，那么你很有可能走到从-2转移过来的边，这显然是不合法的。还有，我们要枚举的是i前面的点，所以当你枚举的点>=i时，也是不合法的
```c++
#include<iostream>
#include<cstring>
#include<cstdio>
using namespace std;
const int mod(1000000007);
int n,m,k;
int st;
int bin[10];
int f[35][35][1<<9][35];
int main(){
    bin[0]=1;
    for(int i=1;i<=9;i++)
        bin[i]=bin[i-1]<<1;
    scanf("%d%d%d",&n,&m,&k);
    st=bin[k+1]-1;
    f[1][0][0][0]=1;
    for(int i=1;i<=n;i++)
        for(int j=0;j<=m;j++)
            for(int o=0;o<=st;o++)
                for(int l=0;l<=k;l++){
                    if(l==k&&!(o&1)){
                        f[i+1][j][o>>1][0]+=f[i][j][o][l];
                        f[i+1][j][o>>1][0]%=mod;
                    }
                    f[i][j][o][l+1]+=f[i][j][o][l];
                    f[i][j][o][l+1]%=mod;
                    if(j<m&&i-k+l>0&&i-k+l<i){
                        f[i][j+1][o^bin[k]^bin[l]][l]+=f[i][j][o][l];
                        f[i][j+1][o^bin[k]^bin[l]][l]%=mod;
                    }
                }
    printf("%d",f[n+1][m][0][0]);
}
```
这么短的码，然而自己没思路，也不能怪谁= =